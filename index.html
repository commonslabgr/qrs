<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Υπηρεσία προταιρεότητας εξυπηρέτησης πολιτών</title>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <link rel="stylesheet" href="css/icon.css">
        <link rel="stylesheet" href="css/material.indigo-pink.min.css">
        <script defer src="js/material.min.js"></script>    
        <link rel="stylesheet" href="css/widget.css">
    </head>
    
    <body>
    <div id="wrapper">
    <div id="info">
       <div class="demo-card-wide mdl-card mdl-shadow--2dp">
  <div class="mdl-card__title">
      <div class="text-gradient">
    <h4 class="mdl-card__title-text">CommonsLab | QRS</h4>
    </div>
  </div>
  <div class="mdl-card__supporting-text">
    Καλώς ορίσατε στην Υπηρεσία προταιρεότητας εξυπηρέτησης πολιτών σε Δημόσιες Υπηρεσίες.
    <br><br>
    Για να ξεκινήσετε, επιλέξτε τη πόλη σας και την υπηρεσία που επιθυμείτε.
    <br><br>
    Μετά θα εμφανιστούν οι πληροφορίες σχετικά με το σύστημα προταιρεότητας στην υπηρεσία της επιλογής σας. 
  </div>
</div> 
</div>
    <div id="sidebar">
        <label>ΠΕΡΙΟΧΗ: <br><select>
            <option value=11>ΗΡΑΚΛΕΙΟ</option>
            <option value=0 disabled>ΛΑΣΙΘΙ</option>
            <option value=0 disabled>ΡΕΘΥΜΝΟ</option>
            <option value=0 disabled>ΧΑΝΙΑ</option>
        </select></label>
        <br>
        <label>ΥΠΗΡΕΣΙΑ:<br> <select id="ofc_selected">
            <option value="1" selected="selected">ΟΑΕΔ</option>
            <option value=0 disabled>ΙΚΑ-ΕΤΑΜ</option>
            <option value="2">ΕΛΤΑ - Κέντρο</option>
            <option value="3">ΕΛΤΑ - Εθν. Αντιστάσεως</option>
            <option value=0 disabled>ΕΟΠΠΥ</option>
            <option value=0 disabled>ΚΕΠ</option>
            <option value=0 disabled>...</option>
        </select></label>
        <br>
        <p>
            <br>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="initMap()">ΕΜΦΑΝΙΣΗ</button>
        </p>
        <p><a href="map.html">Παράδειγμα εμφάνισης πολλαπλών σημείων εξυπηρέτησης μαζί με τους χρόνους αναμονής</a></p>
    </div>    

        <div id="main-card" class="demo-card-square mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title mdl-card--expand mdl-card__title_img">
                <div class="text-gradient">
                <h2 id="city-name" class="mdl-card__title-text"></h2>
                </div>
            </div>
            <div class="mdl-card__supporting-text">
                <ul id="jsondata" class="demo-list-item mdl-list">
                </ul>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a id="toggle-map" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                ΧΑΡΤΗΣ
                </a>
                <a id="toggle-notify" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                ΕΙΔΟΠΟΙΗΣΗ
                </a>
            </div>
        </div>
        <div id="map-card" class="demo-card-square mdl-card mdl-shadow--2dp card-map">
            <div class="mdl-card__title mdl-card--expand">
                <h2 id="map-title" class="mdl-card__title-text"></h2>
            </div>
            <div id="map"></div>
            <div class="mdl-card__actions mdl-card--border">
                <a id="back-map" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                ΠΙΣΩ
                </a>
            </div>
        </div>
        <div id="notify-card" class="demo-card-square mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title mdl-card--expand mdl-card__title_img">
                <div class="text-gradient">
                <h4 id="service-title" class="mdl-card__title-text">ΥΠΗΡΕΣΙΑ ΕΙΔΟΠΟΙΗΣΗΣ</h4>
                </div>
            </div>
            <div class="mdl-card__supporting-text">
                <form action="#">
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="sample2">
                        <label class="mdl-textfield__label" for="sample2">Αριθμός σειράς...</label>
                        <span class="mdl-textfield__error">Input is not a number!</span>
                    </div>
                </form>
                <form action="#">
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" id="sample1">
                        <label class="mdl-textfield__label" for="sample1">Email...</label>
                    </div>
                </form>
                <form action="#">
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="sample2">
                        <label class="mdl-textfield__label" for="sample2">SMS...</label>
                        <span class="mdl-textfield__error">Input is not a number!</span>
                    </div>
                </form>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                ΕΓΓΡΑΦΗ
                </a>
                <a id="back-notify" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                ΠΙΣΩ
                </a>    
            </div>
        </div>        

<script type="text/javascript">
    var map;
    //Initialize Map
    function initMap() {
        //Get Selected office id
	    var office_id = $("#ofc_selected").val();
        //Request data from API
        var url="queue.php?id="+String(office_id);
        //Parse JSON data
        $.getJSON(url,function(data){
            $.each(data.queue, function(i,queue){
                //Set Logo
                $(".mdl-card__title_img").css("background", "url('ofc_logos/"+queue.type_id+".jpg') bottom right 15% no-repeat #fff");
                $(".mdl-card__title_img").css("background-position", "center");
                $(".mdl-card__title_img").css("background-size", "66%");
                //Set City Name
                $("#city-name").text(queue.city);
                //Set Title on Map card
                $("#map-title").text(String(queue.name+' '+queue.city).toUpperCase());
                
                $("#jsondata").html("");
                
                //Set Data
                var newRow = '<li class="mdl-list__item">'+
                            '<span class="mdl-list__item-primary-content">'+
                            '<img src="icons/ticket-48px.png"><h4>'+queue.nr_given+'</h4><h6>αρ. αναμονής</h6>'+
                            '</span>'+
                            '</li>'+
                            '<li class="mdl-list__item">'+
                            '<span class="mdl-list__item-primary-content">'+
                            '<img src="icons/clerk-48px.png"><h4>'+queue.nr_serving+'</h4><h6>αρ. εξυπηρέτησης</h6>'+
                            '</span>'+
                            '</li>'+
                            '<li class="mdl-list__item">'+
                            '<span class="mdl-list__item-primary-content">'+
                            '<img src="icons/hourglass-48px.png"><h4>'+((parseInt(queue.nr_given - queue.nr_serving))*parseFloat(queue.est_serving_time_min))+'</h4><h6>λεπτά</h6>'+
                            '</span>'+
                            '</li>';
                $(newRow).appendTo("#jsondata");
                //Set coordinates for map
                myLatLng = {lat:'', lng:''};
                myLatLng['lat'] = parseFloat(queue.latitude);
                myLatLng['lng'] = parseFloat(queue.longtitude);
                map = new google.maps.Map(document.getElementById('map'), {
                    center: myLatLng,
                    zoom: 16,
                    zoomControl: true,
                    mapTypeControl: true,
                    scaleControl: false,
                    streetViewControl: false,
                    rotateControl: false,
                    fullscreenControl: false
                });
                
                //Set content for infobox in map
                var contentString='<p>'+queue.name+' '+queue.city+'</p>'+
                                  '<div>Διεύθυνση:'+queue.address+'<br>Τηλέφωνο:'+queue.telephone+'</div>';
        
                var infowindow = new google.maps.InfoWindow({
                    content: contentString,
                    maxWidth: 150
                });
                
                //Place marker on map
                var marker = new google.maps.Marker({
                    position: myLatLng,
                    map: map,
                    title: 'Map'
                });
                
                //Add listener on marker to open info window
                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                });

            });
        }); 
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdfNsqF3vfIaL4fod1ZACIGQMcXakbxWg&callback=initMap"
    async defer></script>
<script type="text/javascript">
$(document).ready(function(){  
    //Map button 
    $("#toggle-map").click(function(){
        $("#map-card").show();
        initMap();
        $("#main-card").hide();
    });
    //Back button from map
    $("#back-map").click(function(){
        $("#map-card").hide();
        $("#main-card").show();        
    });
    //Notify button
    $("#toggle-notify").click(function(){
        $("#notify-card").show();
        $("#main-card").hide();            
    });
    //Back button from notify
    $("#back-notify").click(function(){
        $("#notify-card").hide();
        $("#main-card").show();    
    });    
    //Hide at load the map and notify cards
    $("#notify-card").hide();
    $("#map-card").hide();
});    
</script>
   <p>&nbsp;</p>
   <p>&nbsp;</p>
   <div id="footer">
   <a href="https://github.com/commonslabgr/qrs">QRS on Github</a><div style="float:right;">Idea, design and implementation of <a href="http://commonslab.gr">CommonsLab</a></div>
   </div>
   </div>
    </body>
</html>
